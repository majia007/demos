<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	<title>EVE等效DPS计算</title>
</head>
<body>
	<div id="dpsBox"></div>
	<hr>
	<div id="defBox"></div>
	<hr>
	<p>
		<button id="addDps">添加输出</button>
		<button id="addDef">添加防御</button>
	</p>
</body>
<script>
	let dpsIndex = 0;
	function addDpsItem() {
		document.getElementById('dpsBox').insertAdjacentHTML('beforeend', `
			<div>输出${++dpsIndex}</div>
			<input class="damage" type="text" placeholder="伤害分布(电,热,动,爆)">
			<input class="DPS" type="text" placeholder="dps">
		`);
	}
	document.getElementById('addDps').addEventListener('click', addDpsItem);
</script>
<script>
	let defIndex = 0;
	function addDefItem() {
		document.getElementById('defBox').insertAdjacentHTML('beforeend', `
			<div>防御${++defIndex}</div>
			<input class="defend" type="text" placeholder="抗性分布(电,热,动,爆)">
			<output class="result">--数据不完整--</output>
		`);
	}
	document.getElementById('addDef').addEventListener('click', addDefItem);
</script>
<script>
	function sum(vals) {
		return vals.reduce((r, val) => (r + val));
	}
	function calc() {
		const damages = [...document.querySelectorAll('.damage')];
		const defends = [...document.querySelectorAll('.defend')];
		defends.forEach((defendInput) => {
			const 抗性 = defendInput.value.split(/[^\d.]/).map(Number);
			if (抗性.some(isNaN)) return defendInput.nextElementSibling.innerText = '--数据不完整--';
			const res = damages.reduce((res, damageInput) => {
				if (!damageInput.value) return res;
				const 分布 = damageInput.value.split(/[^\d.]/).map(Number);
				if (分布.some(isNaN)) return res;
				const dps = +damageInput.nextElementSibling.value || sum(分布);
				if (!dps) return res;
				return [0, 1, 2, 3].map(index => res[index] + ((分布[index] || 0) / sum(分布)) * dps * (100 - 抗性[index]) / 100);
			}, [0, 0, 0, 0]);
			defendInput.nextElementSibling.innerText = sum(res) || '--数据不完整--';
		});
	}
	document.addEventListener('input', calc);
</script>
<script>
	addDpsItem();
	addDpsItem();
	addDefItem();
	addDefItem();
</script>
</html>
