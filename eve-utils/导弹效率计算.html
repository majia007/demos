<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	<title>导弹效率计算</title>
	<style>
		label {
			margin: 12px 0;
		}
		img {
			max-width: 100%;
			height: 356px;
			object-fit: cover;
			object-position: center bottom;
		}
	</style>
</head>
<body>
	<section>
		<img src="./images/导弹公式.jpg" alt="系数">
	</section>
	<section>
		衰减指数 <br><input type="text" id="衰减指数" data-step="0.1"><br>
		爆炸半径 <br><input type="text" id="爆炸半径"><br>
		爆炸速度 <br><input type="text" id="爆炸速度"><br>
		<hr>
		目标半径 <br><input type="text" id="目标半径"><br>
		目标速度 <br><input type="text" id="目标速度"><br>
		原始输出 <br><input type="text" id="原始输出"><br>
	</section>
	<hr>
	<section>
		伤害比例 <br>
		<output type="text" id="伤害比例"></output>
		<br>
		最终输出 <br>
		<output type="text" id="最终输出"></output>
		<br>
	</section>
	<hr>
	<section>
		<button id="开新窗口">开新窗口</button>
	</section>
</body>
<script>
	window.衰减指数 = document.getElementById('衰减指数');
	window.爆炸半径 = document.getElementById('爆炸半径');
	window.爆炸速度 = document.getElementById('爆炸速度');
	window.目标半径 = document.getElementById('目标半径');
	window.目标速度 = document.getElementById('目标速度');
	window.原始输出 = document.getElementById('原始输出');
	window.伤害比例 = document.getElementById('伤害比例');
	window.最终输出 = document.getElementById('最终输出');
	window.开新窗口 = document.getElementById('开新窗口');

	开新窗口.addEventListener('click', () => {
		window.open(location.href, '_blank', `width=450,height=880,left=${window.screenLeft + 32},top=${window.screenTop + 32}`);
	});

	衰减指数.value = localStorage.getItem('衰减指数') || '0';
	爆炸半径.value = localStorage.getItem('爆炸半径') || '0';
	爆炸速度.value = localStorage.getItem('爆炸速度') || '0';
	目标半径.value = localStorage.getItem('目标半径') || '0';
	目标速度.value = localStorage.getItem('目标速度') || '0';
	原始输出.value = localStorage.getItem('原始输出') || '100';

	function getValue(node) {
		return node.value.match(/[^\d.]/) && +(eval(node.value)) || +node.value || 0;
	}
	function showValue(num, rate = 1) {
		return (Math.round(num * 100 * rate)) / 100;
	}

	function 计算() {
		const 衰减指数 = getValue(window.衰减指数);
		const 爆炸半径 = getValue(window.爆炸半径);
		const 爆炸速度 = getValue(window.爆炸速度);
		const 目标半径 = getValue(window.目标半径);
		const 目标速度 = getValue(window.目标速度);
		const 原始输出 = getValue(window.原始输出);
		localStorage.setItem('衰减指数', 衰减指数 || '0');
		localStorage.setItem('爆炸半径', 爆炸半径 || '0');
		localStorage.setItem('爆炸速度', 爆炸速度 || '0');
		localStorage.setItem('目标半径', 目标半径 || '0');
		localStorage.setItem('目标速度', 目标速度 || '0');
		localStorage.setItem('原始输出', 原始输出 || '0');

		const result = Math.min(
			1,
			目标半径 / 爆炸半径,
			((爆炸速度 * 目标半径) / (爆炸半径 * 目标速度)) ** (Math.log(衰减指数) / Math.log(5.5)),
		);
		伤害比例.textContent = result ? showValue(result, 100) + '%' : '数据不足';
		最终输出.innerHTML = result ? showValue(原始输出, result) : '数据不足';
	}

	window.oninput = 计算() || 计算;

	document.querySelectorAll('input').forEach(dom => dom.onmousewheel = e => {
		const dom = e.target;
		dom.value = Math.round(100 * (getValue(dom) + (e.deltaY < 0 ? 1 : -1) * (+dom.dataset.step || 1))) / 100;
		dom.value = Math.min(Math.max(dom.value, dom.min || 0), dom.max || 999999);
		计算();
	});
</script>
</html>
